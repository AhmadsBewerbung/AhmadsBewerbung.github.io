<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>FrontRange 3D Shooter Prototype</title>
<style>
  body { margin: 0; overflow: hidden; background: #111; }
  #hpDisplay {
    position: absolute;
    top: 20px; left: 20px;
    padding: 10px 20px;
    background: rgba(0,0,0,0.5);
    color: #0f0;
    font-size: 28px;
    font-family: Arial, sans-serif;
    border: 2px solid #0f0;
    border-radius: 8px;
  }
  #instructions {
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    color: white;
    font-size: 24px;
    text-align: center;
    font-family: Arial;
  }
</style>
</head>
<body>
<div id="hpDisplay">HP: 300</div>
<div id="instructions">Click to Lock Mouse<br>WASD = Move · SPACE = Jump · Left Click = Shoot</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

<script>

// ------------------------------------------------------
// BASIC THREE.JS SETUP
// ------------------------------------------------------
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x222222);

const camera = new THREE.PerspectiveCamera(70, window.innerWidth / window.innerHeight, 0.1, 2000);

const renderer = new THREE.WebGLRenderer({ antialias:true });
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

// ------------------------------------------------------
// LIGHTING
// ------------------------------------------------------
const light = new THREE.DirectionalLight(0xffffff, 1);
light.position.set(50, 100, 50);
scene.add(light);

const ambient = new THREE.AmbientLight(0x888888);
scene.add(ambient);

// ------------------------------------------------------
// PLAYER
// ------------------------------------------------------
let playerHP = 300;

const playerGeometry = new THREE.BoxGeometry(2, 4, 2);
const playerMaterial = new THREE.MeshStandardMaterial({ color: 0x00aaff });
const player = new THREE.Mesh(playerGeometry, playerMaterial);
player.position.set(0, 2, 0);
scene.add(player);

camera.position.set(0, 5, -10);
camera.lookAt(player.position);

// Movement
let keys = {};

// ------------------------------------------------------
// FLOOR
// ------------------------------------------------------
const floorGeo = new THREE.PlaneGeometry(300, 300);
const floorMat = new THREE.MeshStandardMaterial({ color: 0x444444 });
const floor = new THREE.Mesh(floorGeo, floorMat);
floor.rotation.x = -Math.PI / 2;
scene.add(floor);

// ------------------------------------------------------
// SHOOTING
// ------------------------------------------------------
let bullets = [];

function shoot() {
  const bulletGeo = new THREE.SphereGeometry(0.3);
  const bulletMat = new THREE.MeshStandardMaterial({ color: 0xff0000 });
  const bullet = new THREE.Mesh(bulletGeo, bulletMat);

  bullet.position.copy(player.position);
  bullet.position.y += 1.5;

  // bullet direction is where camera looks
  const dir = new THREE.Vector3();
  camera.getWorldDirection(dir);

  bullet.userData.velocity = dir.clone().multiplyScalar(2);
  bullets.push(bullet);
  scene.add(bullet);
}

window.addEventListener("mousedown", () => {
  shoot();
});

// ------------------------------------------------------
// ENEMY BOTS
// ------------------------------------------------------
const enemies = [];

function spawnEnemy(x, z) {
  const enemyGeo = new THREE.BoxGeometry(2, 4, 2);
  const enemyMat = new THREE.MeshStandardMaterial({ color: 0xffaa00 });
  const enemy = new THREE.Mesh(enemyGeo, enemyMat);
  enemy.position.set(x, 2, z);
  enemy.userData.hp = 100;
  enemies.push(enemy);
  scene.add(enemy);
}

// Spawn 5 bots
spawnEnemy(30, 30);
spawnEnemy(-30, 20);
spawnEnemy(20, -25);
spawnEnemy(-40, -40);
spawnEnemy(10, 50);

// ------------------------------------------------------
// BOT AI (simple follow)
// ------------------------------------------------------
function updateEnemies() {
  enemies.forEach(enemy => {
    const toPlayer = new THREE.Vector3().subVectors(player.position, enemy.position);
    toPlayer.y = 0;
    if (toPlayer.length() > 1) {
      toPlayer.normalize();
      enemy.position.add(toPlayer.multiplyScalar(0.05));
    }
  });
}

// ------------------------------------------------------
// MOUSE CAMERA LOOK
// ------------------------------------------------------
let pitch = 0;
let yaw = 0;

document.body.addEventListener('click', () => {
  document.body.requestPointerLock();
});

document.addEventListener('mousemove', (e) => {
  if (document.pointerLockElement === document.body) {
    yaw -= e.movementX * 0.002;
    pitch -= e.movementY * 0.002;
    pitch = Math.max(-1, Math.min(1, pitch));
  }
});

// ------------------------------------------------------
// KEYBOARD MOVEMENT
// ------------------------------------------------------
document.addEventListener("keydown", (e) => keys[e.code] = true);
document.addEventListener("keyup",   (e) => keys[e.code] = false);

let velocityY = 0;

// ------------------------------------------------------
// GAME LOOP
// ------------------------------------------------------
function animate() {
  requestAnimationFrame(animate);

  // third person camera follows player
  const camOffset = new THREE.Vector3(0, 5, -10);
  let rotMatrix = new THREE.Matrix4().makeRotationY(yaw);
  let camPos = camOffset.clone().applyMatrix4(rotMatrix);
  camera.position.copy(player.position.clone().add(camPos));
  camera.lookAt(player.position.clone().add(new THREE.Vector3(0, 2, 0)));

  // movement
  const speed = 0.2;
  const forward = new THREE.Vector3(Math.sin(yaw), 0, Math.cos(yaw));
  const right = new THREE.Vector3(Math.cos(yaw), 0, -Math.sin(yaw));

  if (keys["KeyW"]) player.position.add(forward.clone().multiplyScalar(speed));
  if (keys["KeyS"]) player.position.add(forward.clone().multiplyScalar(-speed));
  if (keys["KeyA"]) player.position.add(right.clone().multiplyScalar(-speed));
  if (keys["KeyD"]) player.position.add(right.clone().multiplyScalar(speed));

  // gravity + jump
  if (keys["Space"] && player.position.y <= 2.01) {
    velocityY = 0.35;
  }
  velocityY -= 0.015;
  player.position.y += velocityY;
  if (player.position.y < 2) {
    player.position.y = 2;
    velocityY = 0;
  }

  // move bullets
  bullets.forEach((b, i) => {
    b.position.add(b.userData.velocity);

    // check enemy hits
    enemies.forEach(enemy => {
      if (b.position.distanceTo(enemy.position) < 2) {
        enemy.userData.hp -= 50;
        scene.remove(b);
        bullets.splice(i, 1);
      }
    });
  });

  // remove dead enemies
  for (let i=enemies.length-1; i>=0; i--) {
    if (enemies[i].userData.hp <= 0) {
      scene.remove(enemies[i]);
      enemies.splice(i, 1);
    }
  }

  updateEnemies();

  renderer.render(scene, camera);
}
animate();

</script>
</body>
</html>
